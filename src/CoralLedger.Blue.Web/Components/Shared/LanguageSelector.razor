@inject NavigationManager Navigation
@inject IJSRuntime JS

<RadzenDropDown TValue="string" 
                Value="@_currentCulture"
                Data="@_supportedCultures"
                TextProperty="DisplayName"
                ValueProperty="Code"
                Change="@OnCultureChanged"
                Style="width: 120px; min-width: 120px;"
                aria-label="Select language">
</RadzenDropDown>

@code {
    private string _currentCulture = "en";
    
    private readonly List<CultureOption> _supportedCultures = new()
    {
        new CultureOption { Code = "en", DisplayName = "English" },
        new CultureOption { Code = "es", DisplayName = "Español" },
        new CultureOption { Code = "ht", DisplayName = "Kreyòl" }
    };

    protected override async Task OnInitializedAsync()
    {
        // Get current culture from cookie using safe helper function
        _currentCulture = await JS.InvokeAsync<string>("localization.getCurrentCulture");
    }

    private async Task OnCultureChanged(object value)
    {
        var culture = value?.ToString() ?? "en";
        
        // Set culture cookie using safe helper function
        await JS.InvokeVoidAsync("localization.setCulture", culture);
        
        // Reload page to apply new culture
        Navigation.NavigateTo(Navigation.Uri, forceLoad: true);
    }

    private class CultureOption
    {
        public string Code { get; set; } = string.Empty;
        public string DisplayName { get; set; } = string.Empty;
    }
}
